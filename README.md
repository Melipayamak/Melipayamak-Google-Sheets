# ارسال پیامک از گوگل شیت ملی پیامک - Send SMS From Google Sheets
Apps Script for melipayamak's web services

<div dir='rtl'>

### معرفی وب سرویس ملی پیامک
<p>
ملی پیامک یک وب سرویس کامل برای ارسال و دریافت پیامک و پیامک صوتی و مدیریت کامل خدمات دیگر است که براحتی میتوانید از آن استفاده کنید.
</p>
<p align="center">
<!--   <picture> -->
<!--     <source media="(prefers-color-scheme: dark)" srcset="./media/3x-ui-dark.png"> -->
<!--     <img alt="3x-ui" src="./media/3x-ui-light.png"> -->
<!--   </picture> -->
</p>

<hr>

### نصب

<p>قبل از نصب نیاز به ثبت‌نام در سایت ملی پیامک دارید.</p>

[**ثبت نام به همراه دریافت 200 پیامک هدیه جهت تست وبسرویس**](https://www.melipayamak.com/)


<p>پس ازثبت نام  برای نصب از راههای زیر میتوانید اقدام کنید.</p>



</div>



### آموزش ارسال پیامک با Google Sheets و وب‌سرویس ملی‌پیامک

<p>
این پروژه به شما امکان می‌دهد که مستقیماً از داخل <strong>Google Sheets</strong> پیامک‌های انبوه یا تکی ارسال کنید. 
این کار با استفاده از <strong>Google Apps Script</strong> و وب‌سرویس ملی پیامک انجام می‌شود.  
</p>

<p>📌 مناسب برای کسب‌وکارهایی که لیست مشتریان خود را در گوگل شیت نگهداری می‌کنند و می‌خواهند به‌صورت خودکار اطلاعیه‌ها، یادآوری‌ها یا پیام‌های تبلیغاتی ارسال کنند.</p>

<hr>

### پیش‌نیازها
<ol>
  <li>داشتن یک حساب کاربری در <a href="https://www.melipayamak.com/" target="_blank">ملی پیامک</a></li>
  <li>دریافت <strong>نام کاربری (username)</strong> و <strong>رمز عبور (password)</strong> وب‌سرویس</li>
  <li>داشتن یک خط اختصاصی یا استفاده از سرویس خدماتی اشتراکی (پترن)</li>
  <li>دسترسی به Google Sheets و امکان استفاده از Google Apps Script</li>
</ol>

<hr>

### مراحل نصب و راه‌اندازی

### مرحله 1) ساخت فایل Google Sheets
<p>یک فایل جدید گوگل شیت ایجاد کنید. در ستون‌ها اطلاعات زیر را وارد کنید:</p>

<table>
  <thead>
    <tr>
      <th>شماره موبایل</th>
      <th>متن پیام</th>
      <th>نوع سرویس</th>
      <th>وضعیت</th>
      <th>پاسخ سرور</th>
      <th>تاریخ ارسال</th>
      <th>نتیجه</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>09123456789</td>
      <td>سلام! این یک تست است</td>
      <td>خط اختصاصی</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>

<hr>

### مرحله 2) اضافه کردن اسکریپت
<p>
از منوی <code>Extensions</code> → <code>Apps Script</code> وارد محیط کدنویسی شوید و کل کد پروژه (فایل <code>Code.gs</code>) را در آن قرار دهید.
</p>
<hr>

### مرحله 3) پیکربندی اطلاعات حساب
<p>در بالای کد بخش زیر را پیدا کنید و اطلاعات خود را وارد کنید:</p>

<pre><code class="language-js">
const CONFIG = {
  username: "YOUR_USERNAME",     // نام کاربری پنل ملی پیامک
  password: "YOUR_PASSWORD",     // رمز عبور یا توکن API
  from: "YOUR_LINE_NUMBER"       // شمارۀ خط اختصاصی (برای ارسال مستقیم از خط اختصاصی)
};
</code></pre>

### 🔹 خط اختصاصی
<ul>
  <li>در این حالت پیامک‌ها با شمارۀ خط شما (مثلاً 3000xxxx یا 9000xxxx) ارسال می‌شوند.</li>
  <li>باید مقدار <code>from</code> را برابر شمارۀ خط اختصاصی خود قرار دهید.</li>
  <li>نمونۀ استفاده: انتخاب گزینۀ <code>خط اختصاصی</code> در ستون "نوع سرویس".</li>
</ul>

### 🔹 خدماتی اشتراکی (Base / Pattern)
<ul>
  <li>در این حالت ارسال پیامک از طریق پترن و وب سرویس خدماتی ملی پیامک (ارسال پیامک از خط خدماتی اشتراکی) انجام می‌شود.</li>
  <li>باید <code>bodyId</code> مربوط به پترن خود را در تابع <code>sendBaseSMS</code> وارد کنید:</li>
</ul>

<pre><code class="language-js">
function sendBaseSMS(phoneNumber, message) {
  const url = "https://rest.payamak-panel.com/api/SendSMS/BaseServiceNumber";
  const payload = {
    "username": CONFIG.username,
    "password": CONFIG.password,
    "text": message,
    "to": phoneNumber,
    "bodyId": "YOUR_BODY_ID" // عدد پترن خود را اینجا قرار دهید
  };
  ...
}
</code></pre>

<ul>
  <li>نمونۀ استفاده: انتخاب گزینۀ <code>خدماتی اشتراکی</code> در ستون "نوع سرویس".</li>
</ul>

<hr>

### مرحله 4) استفاده از منوی پیامک
<p>
بعد از ذخیرۀ اسکریپت و بازگشت به گوگل شیت، یک منوی جدید با نام 
<strong>📱 سیستم پیامک</strong> 
به منوی اصلی اضافه می‌شود.
</p>

<p>گزینه‌های این منو:</p>
<ul>
  <li><strong>ارسال انبوه پیام‌ها</strong> → ارسال پیامک برای تمام ردیف‌ها</li>
  <li><strong>ایجاد منوی انتخابی</strong> → اضافه کردن dropdown برای انتخاب نوع سرویس</li>
  <li><strong>بازنشانی وضعیت‌ها</strong> → پاک کردن وضعیت ارسال برای تست مجدد</li>
  <li><strong>اضافه کردن ردیف تست</strong> → ایجاد یک ردیف نمونه برای تست سریع</li>
  <li><strong>تست اتصال API</strong> → بررسی ارتباط با وب‌سرویس ملی پیامک</li>
</ul>

<hr>

### نحوۀ کارکرد
<ul>
  <li>اگر در ستون <strong>نوع سرویس</strong> مقدار <code>خط اختصاصی</code> انتخاب شود، پیامک از خط شما ارسال خواهد شد.</li>
  <li>اگر مقدار <code>خدماتی اشتراکی</code> انتخاب شود، پیامک با استفاده از <strong>پترن (Base Service Number)</strong> ارسال می‌شود.</li>
  <li>ستون‌های <strong>وضعیت</strong> و <strong>پاسخ سرور</strong> به صورت خودکار بعد از هر ارسال بروزرسانی می‌شوند.</li>
</ul>

<hr>

### امکانات پروژه
<ul>
  <li>✅ ارسال انبوه پیامک مستقیم از Google Sheets</li>
  <li>✅ پشتیبانی از هر دو حالت <strong>خط اختصاصی</strong> و <strong>سرویس خدماتی اشتراکی</strong></li>
  <li>✅ ثبت وضعیت ارسال، تاریخ و پاسخ سرور در همان شیت</li>
  <li>✅ ایجاد منوی سفارشی در گوگل شیت برای مدیریت پیامک‌ها</li>
  <li>✅ امکان اضافه کردن ردیف تست و تست اتصال API</li>
</ul>

<hr>


**اگر این پروژه برای شما مفید است، می‌توانید به آن یک**:star2: بدهید


<hr/>

###  اطلاعات بیشتر

برای مطالعه بیشتر و دریافت راهنمای وب سرویس ها و آشنایی با پارامتر های ورودی و خروجی وب سرویس به صفحه معرفی
[وب سرویس ملی پیامک](https://github.com/Melipayamak/Webservices)
مراجعه نمایید .

<hr/>
